<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Clone - LiveTemplate Demo</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">üê¶ Twitter Clone</h1>
                <div class="user-info">
                    <span class="username">{{.CurrentUser.Username}}</span>
                    <span class="handle">{{.CurrentUser.Handle}}</span>
                </div>
            </div>
            <!-- Connection Status as Fragment -->
            <div class="connection-status {{.ConnectionStatus}}" data-fragment-id="connection-status">
                {{.ConnectionMessage}}
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="user-profile">
                    <div class="user-avatar">{{slice .CurrentUser.Username 0 1}}</div>
                    <h3>{{.CurrentUser.Username}}</h3>
                    <p class="handle">{{.CurrentUser.Handle}}</p>
                    <div class="user-stats">
                        <div class="stat">
                            <span class="stat-number">{{.CurrentUser.Following}}</span>
                            <span class="stat-label">Following</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">{{.CurrentUser.Followers}}</span>
                            <span class="stat-label">Followers</span>
                        </div>
                    </div>
                </div>

                <div class="trending">
                    <h3>Who to follow</h3>
                    {{range .Users}}
                    <div class="user-suggestion">
                        <div class="user-avatar small">{{slice .Username 0 1}}</div>
                        <div class="user-details">
                            <div class="username">{{.Username}}</div>
                            <div class="handle">{{.Handle}}</div>
                            <div class="followers">{{.Followers}} followers</div>
                        </div>
                        <button class="follow-btn">Follow</button>
                    </div>
                    {{end}}
                </div>
            </aside>

            <!-- Feed -->
            <main class="feed">
                <!-- Tweet Composer -->
                <div class="tweet-composer">
                    <div class="composer-header">
                        <div class="user-avatar">{{slice .CurrentUser.Username 0 1}}</div>
                        <textarea 
                            id="tweet-input" 
                            placeholder="What's happening?" 
                            maxlength="280"
                            rows="3"
                            data-action="input"
                            data-target="composer">{{.ComposerText}}
                        </textarea>
                    </div>
                    <div class="composer-actions">
                        <span id="char-count">{{.CharCount}}</span>
                        <button id="tweet-btn" 
                                class="tweet-btn{{if .TweetDisabled}} disabled{{end}}" 
                                data-action="tweet"
                                {{if .TweetDisabled}}disabled{{end}}>
                            {{if .TweetPosting}}Posting...{{else}}Tweet{{end}}
                        </button>
                    </div>
                </div>

                <!-- Tweet Feed -->
                <div class="tweet-feed">
                    {{range .Tweets}}
                    <article class="tweet" data-tweet-id="{{.ID}}">
                        <div class="tweet-header">
                            <div class="user-avatar">{{slice .Username 0 1}}</div>
                            <div class="tweet-meta">
                                <span class="username">{{.Username}}</span>
                                <span class="handle">{{.Handle}}</span>
                                <span class="timestamp">{{.Timestamp.Format "Jan 2, 15:04"}}</span>
                            </div>
                        </div>
                        <div class="tweet-content">
                            <p>{{.Content}}</p>
                        </div>
                        <div class="tweet-actions">
                            <button class="action-btn reply-btn" data-action="reply" data-tweet-id="{{.ID}}">
                                <span class="icon">üí¨</span>
                                <span class="count">Reply</span>
                            </button>
                            <!-- Retweet button as fragment for real-time state updates -->
                            <button class="action-btn retweet-btn {{if .Retweeted}}active{{end}}" 
                                    data-fragment-id="retweet-{{.ID}}"
                                    data-action="retweet" 
                                    data-tweet-id="{{.ID}}">
                                <span class="icon">üîÅ</span>
                                <span class="count">{{if gt .Retweets 0}}{{.Retweets}}{{else}}Retweet{{end}}</span>
                            </button>
                            <!-- Like button as fragment for real-time state updates -->
                            <button class="action-btn like-btn {{if .Liked}}active{{end}}" 
                                    data-fragment-id="like-{{.ID}}"
                                    data-action="like" 
                                    data-tweet-id="{{.ID}}">
                                <span class="icon">{{if .Liked}}‚ù§Ô∏è{{else}}ü§ç{{end}}</span>
                                <span class="count">{{if gt .Likes 0}}{{.Likes}}{{else}}Like{{end}}</span>
                            </button>
                            <button class="action-btn share-btn" data-action="share" data-tweet-id="{{.ID}}">
                                <span class="icon">üì§</span>
                                <span class="count">Share</span>
                            </button>
                        </div>
                    </article>
                    {{end}}
                </div>
            </main>
        </div>
    </div>

    <!-- LiveTemplate Client -->
    <script src="/static/js/livetemplate-client.js"></script>
    <script>
        // Initialize LiveTemplate client with page token and connection details
        const pageToken = window.LIVETEMPLATE_TOKEN; // Injected by server
        const client = new LiveTemplateClient({
            pageToken: pageToken,
            wsUrl: 'ws://localhost:8080/ws',
            ajaxUrl: '/api',
            debug: true
        });

        // Initialize the Twitter clone app
        document.addEventListener('DOMContentLoaded', () => {
            initTwitterApp(client);
        });
    </script>
    <script src="/static/js/twitter-app.js"></script>
</body>
</html>